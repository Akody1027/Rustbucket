<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map" style="position: fixed; width: 100%; height: 100%; z-index: 1;"></div>

    <div class="app-screen" style="position: relative; z-index: 2; pointer-events: none; background: transparent;">
        
        <div style="padding: 20px; pointer-events: auto;">
            <div class="card" style="margin:0; display: flex; align-items: center; padding: 10px 20px;">
                <span style="font-weight: bold; color: var(--primary);">DISPATCH</span>
                <div style="margin-left: auto; display: flex; gap: 10px;">
                    <label style="font-size: 11px; color: var(--text-gray);"><input type="checkbox" checked> Drivers</label>
                    <label style="font-size: 11px; color: var(--text-gray);"><input type="checkbox" checked> Stops</label>
                </div>
            </div>
        </div>

        <div id="trip-planner" class="tab-pane">
            <div style="width: 40px; height: 4px; background: #e0e0e0; border-radius: 10px; margin: 0 auto 15px;"></div>
            <h2>Create New Route</h2>
            
            <div class="input-field-group" style="margin-bottom: 20px;">
                <label style="font-size: 11px; font-weight: 700; color: var(--text-gray);">PO NUMBER</label>
                <input type="text" placeholder="e.g. #99281" class="input-field">
            </div>

            <div id="stops-container">
                <div class="card" style="background: #F8F9FA; box-shadow: none; border: 1px solid var(--border); margin: 0 0 10px 0;">
                    <input type="text" placeholder="Customer Name" class="input-field" style="background: white;">
                    <input type="text" placeholder="Address" class="input-field" style="background: white;">
                    <textarea placeholder="Priority instructions (Optional)..." class="input-field" style="background: white; height: 60px;"></textarea>
                </div>
            </div>

            <button class="btn-main" style="background: #f0f0f0; color: var(--text-dark); margin-bottom: 10px;" onclick="addStop()">+ Add Waypoint</button>
            
            <div style="padding: 15px 0;">
                <label style="font-size: 11px; font-weight: 700; color: var(--text-gray);">ASSIGN DRIVER</label>
                <select class="input-field">
                    <option>Select Active Driver...</option>
                </select>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn-main" style="flex: 2;" onclick="dispatchLoad()">Dispatch Load</button>
                <button class="btn-main" style="flex: 1; background: var(--success);" onclick="optimizeRoute()">Optimize</button>
            </div>
        </div>

        <div id="fleet-view" class="tab-pane hidden">
            <div style="width: 40px; height: 4px; background: #e0e0e0; border-radius: 10px; margin: 0 auto 15px;"></div>
            <h2>Active Fleet</h2>
            <div class="card" style="background: #F8F9FA; box-shadow: none; border: 1px solid var(--border); margin: 10px 0;">
                <div style="display: flex; justify-content: space-between;">
                    <strong>John Doe</strong>
                    <span style="color: var(--success); font-size: 12px;">‚óè Online</span>
                </div>
                <p style="margin: 5px 0 0 0;">Unit #442 | PO #8821</p>
            </div>
        </div>

        <div id="chat-room" class="tab-pane hidden">
            <div style="width: 40px; height: 4px; background: #e0e0e0; border-radius: 10px; margin: 0 auto 15px;"></div>
            <h2>Messages</h2>
            <div id="chat-display" style="height: 250px; overflow-y: auto; margin-bottom: 15px;">
                <div style="background: var(--primary); color: white; padding: 10px; border-radius: 12px; margin-bottom: 10px; width: fit-content;">
                    Route updated for Unit 442.
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="input-field" placeholder="Message..." style="margin-bottom:0;">
                <button class="btn-main" style="width: auto; padding: 0 20px;">Send</button>
            </div>
        </div>

        <div class="bottom-nav" style="pointer-events: auto;">
            <div class="nav-tab active" onclick="switchTab('trip-planner')">
                <div style="font-size: 20px;">üìç</div>
                <span>Planner</span>
            </div>
            <div class="nav-tab" onclick="switchTab('fleet-view')">
                <div style="font-size: 20px;">üöö</div>
                <span>Fleet</span>
            </div>
            <div class="nav-tab" onclick="switchTab('chat-room')">
                <div style="font-size: 20px;">üí¨</div>
                <span>Chat</span>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="app-logic.js"></script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpSeGraT4Oee7tU5WjCfPr9Dskd0smdmU&callback=initMap"></script>

    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
