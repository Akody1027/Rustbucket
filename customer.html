<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuralDrop | Search & Verify</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpSeGraT4Oee7tU5WjCfPr9Dskd0smdmU&libraries=places"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=AZ1st2QfbDjcDTmMwT27gZM2CtVRujmmQoLGSQuoC5HeBUgp1cWOk9NnFtelXrPW5viW2EXpEK3gqHDf&currency=USD"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        .map-container { position: relative; width: 100%; height: 300px; transition: all 0.4s ease; border-radius: 2rem; overflow: hidden; border: 2px solid #e2e8f0; }
        .map-fullscreen { position: fixed; top: 0; left: 0; height: 100vh !important; width: 100vw !important; z-index: 1000; border-radius: 0; }
        .map-tools { position: absolute; bottom: 1rem; right: 1rem; z-index: 1001; }
    </style>
</head>
<body class="bg-slate-50 antialiased font-sans">

<div id="app" v-cloak>
    <main class="max-w-xl mx-auto p-6 min-h-screen flex flex-col justify-center">
        
        <div v-if="!myOrder" class="bg-white p-8 rounded-[3rem] shadow-2xl border border-slate-100">
            <div v-if="step === 1">
                <h2 class="text-2xl font-black mb-6 tracking-tight">Verify Pickup</h2>
                
                <input id="pickup-search" placeholder="Search (within 100 miles)..." 
                       class="w-full p-4 bg-slate-50 rounded-2xl font-bold border-none outline-none focus:ring-2 focus:ring-indigo-600 mb-4">

                <div :class="['map-container', isFullscreen ? 'map-fullscreen' : '']">
                    <div id="verify-map" class="h-full w-full"></div>
                    
                    <div class="map-tools flex flex-col gap-2">
                        <button @click="toggleMapSize" class="bg-white p-3 rounded-full shadow-lg text-slate-700 hover:bg-indigo-600 hover:text-white transition-all">
                            <i :class="isFullscreen ? 'fas fa-compress' : 'fas fa-expand'"></i>
                        </button>
                    </div>
                </div>

                <div v-if="selectedLocation" class="mt-4 p-4 bg-indigo-50 rounded-2xl">
                    <p class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Confirmed Location</p>
                    <p class="text-sm font-bold text-slate-700">{{ selectedLocation.name }}</p>
                </div>

                <button @click="confirmStepOne" :disabled="!selectedLocation" class="w-full bg-slate-900 text-white py-5 rounded-3xl font-black mt-8">Confirm & Continue</button>
            </div>
            </div>
    </main>
</div>

<script>
// Firebase Config (Same as before)
const firebaseConfig = { apiKey: "AIzaSyCgAjQPRCGAQEHyco2ORW6LdOv6yZ61nm0", databaseURL: "https://rustbucketdelivery-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const { createApp } = Vue;

createApp({
    data() {
        return {
            step: 1, isFullscreen: false, map: null, marker: null, selectedLocation: null,
            newOrder: { pickups: [], delivery: '' }
        }
    },
    methods: {
        initMap() {
            const userLocation = { lat: 41.2565, lng: -95.9345 };
            this.map = new google.maps.Map(document.getElementById("verify-map"), {
                center: userLocation,
                zoom: 12,
                disableDefaultUI: true
            });

            // 100 MILE SEARCH BIAS
            const searchCircle = new google.maps.Circle({
                center: userLocation,
                radius: 160934 // 100 miles in meters
            });

            const input = document.getElementById("pickup-search");
            const searchBox = new google.maps.places.SearchBox(input, {
                bounds: searchCircle.getBounds()
            });

            searchBox.addListener("places_changed", () => {
                const place = searchBox.getPlaces()[0];
                this.updateMarker(place.geometry.location, place.name + " " + place.formatted_address);
                this.map.setCenter(place.geometry.location);
                this.map.setZoom(16);
            });

            // ALLOW MANUAL PIN DROPPING
            this.map.addListener("click", (e) => {
                this.updateMarker(e.latLng, "Custom Dropped Pin");
            });
        },
        updateMarker(location, name) {
            if (this.marker) this.marker.setMap(null);
            this.marker = new google.maps.Marker({
                position: location,
                map: this.map,
                animation: google.maps.Animation.DROP
            });
            this.selectedLocation = { name: name, lat: location.lat(), lng: location.lng() };
        },
        toggleMapSize() {
            this.isFullscreen = !this.isFullscreen;
            // Trigger Google Maps to resize properly
            setTimeout(() => { google.maps.event.trigger(this.map, "resize"); }, 100);
        },
        confirmStepOne() { this.step = 2; /* ... rest of your existing logic */ }
    },
    mounted() { this.initMap(); }
}).mount('#app');
</script>
</body>
</html>
